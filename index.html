<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Car Simulator — Interior View</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{margin:0;height:100%;overflow:hidden;background:#87ceeb;}
#hud{position:absolute;top:12px;left:12px;color:#fff;font-family:system-ui;background:rgba(0,0,0,.35);padding:10px 12px;border-radius:8px;z-index:10}
#hud b{color:#ffd700;}
#speed{margin-top:6px;}
#banner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;background:rgba(0,0,0,.6);padding:12px 16px;border-radius:10px;display:none;z-index:20;font-family:system-ui;font-weight:600;}
#person{position:absolute;right:16px;bottom:16px;width:120px;height:220px;display:none;z-index:30;filter:drop-shadow(0 8px 24px rgba(0,0,0,0.35));}
#joystick{position:absolute;bottom:20px;left:20px;width:120px;height:120px;background:rgba(0,0,0,.25);border-radius:50%;touch-action:none;z-index:20}
#stick{position:absolute;left:40px;top:40px;width:40px;height:40px;background:#fff;border-radius:50%;opacity:.9}
</style>
</head>
<body>
<div id="hud">
  <div><b>Controls:</b> Arrow keys to drive (↑ accelerate, ↓ brake, ←/→ steer), R to reset</div>
  <div id="speed">Speed: 0 km/h</div>
</div>
<div id="banner">Crash detected — driver exits vehicle!</div>
<div id="person"></div>
<div id="joystick"><div id="stick"></div></div>

<!-- Background Music -->
<audio id="bgmusic" loop autoplay>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/16/audio_8f3cdb71d3.mp3?filename=peaceful-background-music-112-1.mp3" type="audio/mpeg">
</audio>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script>
/* ================= SCENE ================= */
const scene=new THREE.Scene(); scene.background=new THREE.Color(0x87ceeb);
const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,3000);
const renderer=new THREE.WebGLRenderer({antialias:true}); renderer.setSize(innerWidth,innerHeight); renderer.shadowMap.enabled=true;
document.body.appendChild(renderer.domElement);

/* ================= LIGHT ================= */
scene.add(new THREE.HemisphereLight(0xffffff,0x444444,.7));
const sun=new THREE.DirectionalLight(0xffffff,.9); sun.position.set(100,120,60); sun.castShadow=true; scene.add(sun);
scene.add(new THREE.Mesh(new THREE.SphereGeometry(20,32,32),new THREE.MeshBasicMaterial({color:0xffeb3b})).position.set(100,150,-200));

/* ================= GRASS ================= */
const grass=new THREE.Mesh(new THREE.PlaneGeometry(5000,5000),new THREE.MeshStandardMaterial({color:0x4caf50}));
grass.rotation.x=-Math.PI/2; grass.position.y=-0.01; scene.add(grass);

/* ================= ROAD ================= */
const roadSegments=[],roadMat=new THREE.MeshStandardMaterial({color:0x2a2f36});
const roadGeo=new THREE.PlaneGeometry(200,20);
for(let i=0;i<30;i++){
  const r=new THREE.Mesh(roadGeo,roadMat); r.rotation.x=-Math.PI/2; r.position.x=i*40; scene.add(r); roadSegments.push(r);
}

/* ================= ENVIRONMENT ================= */
function house(x,z){const h=new THREE.Mesh(new THREE.BoxGeometry(12,10,12),new THREE.MeshStandardMaterial({color:0xffcc80})); h.position.set(x,5,z); scene.add(h);}
function office(x,z){const b=new THREE.Mesh(new THREE.BoxGeometry(18,25,18),new THREE.MeshStandardMaterial({color:0x90caf9})); b.position.set(x,12,z); scene.add(b);}
function tree(x,z){const t=new THREE.Mesh(new THREE.ConeGeometry(3,10,8),new THREE.MeshStandardMaterial({color:0x2e7d32})); t.position.set(x,5,z); scene.add(t);}
function mountain(x,z){const m=new THREE.Mesh(new THREE.ConeGeometry(60,120,12),new THREE.MeshStandardMaterial({color:0x757575})); m.position.set(x,60,z); scene.add(m);}
for(let i=0;i<40;i++){house(i*40,-60);office(i*60,60);tree(i*30,-30);}
for(let i=0;i<10;i++) mountain(i*300,-300);

/* ================= DETAILED HYUNDAI I10 ================= */
function buildHyundaiI10Interior(color=0x3a8cff){
  const car=new THREE.Group();
  
  // Exterior body
  const body=new THREE.Mesh(new THREE.BoxGeometry(3.6,1.2,1.6),new THREE.MeshStandardMaterial({color,metalness:.1,roughness:.6})); 
  body.castShadow=true; body.position.y=.8; car.add(body);
  
  // Cabin with windows
  const cabin=new THREE.Mesh(new THREE.BoxGeometry(2.2,.9,1.4),new THREE.MeshStandardMaterial({color:0x222a33,transparent:true,opacity:.7}));
  cabin.position.set(.2,1.25,0); cabin.castShadow=true; car.add(cabin);
  
  // Wheels
  const wheelGeo=new THREE.CylinderGeometry(.35,.35,.25,16); wheelGeo.rotateZ(Math.PI/2); 
  const wheelMat=new THREE.MeshStandardMaterial({color:0x111});
  [[1.2,.35,.75],[1.2,.35,-.75],[-1.2,.35,.75],[-1.2,.35,-.75]].forEach(([x,y,z])=>{
    const w=new THREE.Mesh(wheelGeo,wheelMat); w.position.set(x,y,z); w.castShadow=true; car.add(w);
  });
  
  // Steering wheel
  const wheel=new THREE.Mesh(new THREE.TorusGeometry(0.25,0.05,16,100),new THREE.MeshStandardMaterial({color:0x111}));
  wheel.rotation.x=Math.PI/2; wheel.position.set(0.5,1.5,0); car.add(wheel);
  
  // Seats
  const seatMat=new THREE.MeshStandardMaterial({color:0x555555});
  const driverSeat=new THREE.Mesh(new THREE.BoxGeometry(.5,.8,.5),seatMat); driverSeat.position.set(0.5,1.0,-0.35); car.add(driverSeat);
  const passengerSeat=new THREE.Mesh(new THREE.BoxGeometry(.5,.8,.5),seatMat); passengerSeat.position.set(0.5,1.0,0.35); car.add(passengerSeat);
  
  // Dashboard
  const dash=new THREE.Mesh(new THREE.BoxGeometry(0.2,.6,1.2),new THREE.MeshStandardMaterial({color:0x333333})); 
  dash.position.set(1.2,1.1,0); car.add(dash);
  
  // Doors inner panels
  const doorLeft=new THREE.Mesh(new THREE.BoxGeometry(.05,.9,1.2),new THREE.MeshStandardMaterial({color:0x2a2a2a})); 
  doorLeft.position.set(0.0,1.0,-0.8); car.add(doorLeft);
  const doorRight=new THREE.Mesh(new THREE.BoxGeometry(.05,.9,1.2),new THREE.MeshStandardMaterial({color:0x2a2a2a})); 
  doorRight.position.set(0.0,1.0,0.8); car.add(doorRight);
  
  // Headlights
  const hlMat=new THREE.MeshStandardMaterial({color:0xf5f5f5,emissive:0x222,emissiveIntensity:.6});
  const hlL=new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.2),hlMat); const hlR=hlL.clone(); hlL.position.set(1.9,1,.45); hlR.position.set(1.9,1,-.45); car.add(hlL,hlR);
  
  return car;
}

/* ================= PLAYER ================= */
const player=buildHyundaiI10Interior(); scene.add(player);
let speed=0,steer=0,maxSpeed=22,accel=12,brakeAccel=18,friction=6,steerRate=1.6,steerDecay=2.5;
const keys={ArrowUp:false,ArrowDown:false,ArrowLeft:false,ArrowRight:false,KeyR:false};
window.addEventListener('keydown',e=>{if(keys.hasOwnProperty(e.code))keys[e.code]=true;});
window.addEventListener('keyup',e=>{if(keys.hasOwnProperty(e.code))keys[e.code]=false;});

/* ================= CAMERA INSIDE ================= */
function updateCamera(){
  const camOffset=new THREE.Vector3(0.7,1.25,0); // slightly behind steering wheel
  camera.position.copy(camOffset.applyMatrix4(player.matrixWorld));
  camera.lookAt(player.position.clone().add(new THREE.Vector3(2,1,0)));
}

/* ================= MOBILE JOYSTICK ================= */
const joy=document.getElementById("joystick"); const stick=document.getElementById("stick"); let joyActive=false;
joy.addEventListener("pointerdown",()=>joyActive=true);
joy.addEventListener("pointerup",()=>{joyActive=false;stick.style.left="40px";stick.style.top="40px";});
joy.addEventListener("pointermove",e=>{if(!joyActive)return; const r=joy.getBoundingClientRect(); let x=e.clientX-r.left-60; let y=e.clientY-r.top-60; x=Math.max(-40,Math.min(40,x)); y=Math.max(-40,Math.min(40,y)); stick.style.left=40+x+"px"; stick.style.top=40+y+"px"; steer=-x/40; if(y<0)speed+=accel*0.02; else speed-=brakeAccel*0.02;});

/* ================= ANIMATE ================= */
const speedEl=document.getElementById("speed");
let last=performance.now();
function animate(now){
  const dt=Math.min((now-last)/1000,.05); last=now;
  if(keys.ArrowUp)speed+=accel*dt;
  if(keys.ArrowDown)speed-=brakeAccel*dt;
  if(keys.ArrowLeft)steer+=steerRate*dt;
  if(keys.ArrowRight)steer-=steerRate*dt;
  if(!keys.ArrowLeft&&!keys.ArrowRight){if(steer>0)steer=Math.max(0,steer-steerDecay*dt); else if(steer<0)steer=Math.min(0,steer+steerDecay*dt);}
  speed=THREE.MathUtils.clamp(speed,-8,maxSpeed);
  player.rotation.y+=steer*(speed/maxSpeed)*0.8*dt;
  const f=new THREE.Vector3(1,0,0).applyQuaternion(player.quaternion); player.position.add(f.multiplyScalar(speed*dt));
  updateCamera();
  speedEl.textContent=Math.round(Math.abs(speed)*3.6);
  renderer.render(scene,camera); requestAnimationFrame(animate);
}
requestAnimationFrame(animate);
window.addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Car Simulator â€” Mobile Joystick</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{margin:0;height:100%;overflow:hidden;background:#87ceeb}

/* HUD */
#hud{
position:absolute;top:12px;left:12px;
background:rgba(0,0,0,.45);color:#fff;
padding:10px;border-radius:8px;font-family:system-ui;z-index:10
}

/* JOYSTICK */
#joystick{
position:absolute;bottom:20px;left:20px;
width:120px;height:120px;
border-radius:50%;
background:rgba(0,0,0,.35);
touch-action:none;
}
#stick{
position:absolute;left:35px;top:35px;
width:50px;height:50px;
border-radius:50%;
background:#9bd1ff;
}
</style>
</head>

<body>

<div id="hud">
<b>Controls:</b> Keyboard OR Joystick<br>
<span id="speed">Speed: 0 km/h</span>
</div>

<!-- JOYSTICK -->
<div id="joystick"><div id="stick"></div></div>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

<script>
/* SCENE */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);

/* RENDERER */
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.shadowMap.enabled=true;
document.body.appendChild(renderer.domElement);

/* CAMERA */
const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,2000);

/* LIGHTS */
scene.add(new THREE.HemisphereLight(0xffffff,0x444444,.7));
const sunLight=new THREE.DirectionalLight(0xffffff,.9);
sunLight.position.set(100,120,60);
sunLight.castShadow=true;
scene.add(sunLight);

/* SUN BALL */
const sun=new THREE.Mesh(
new THREE.SphereGeometry(12,32,32),
new THREE.MeshBasicMaterial({color:0xffdd33})
);
sun.position.set(150,160,-300);
scene.add(sun);

/* GROUND */
const grass=new THREE.Mesh(
new THREE.PlaneGeometry(2000,2000),
new THREE.MeshStandardMaterial({color:0x3fa34d})
);
grass.rotation.x=-Math.PI/2;
scene.add(grass);

/* ROAD */
const road=new THREE.Mesh(
new THREE.PlaneGeometry(1800,14),
new THREE.MeshStandardMaterial({color:0x2a2f36})
);
road.rotation.x=-Math.PI/2;
road.position.y=.01;
scene.add(road);

/* FOOTPATHS */
function footpath(z){
const p=new THREE.Mesh(
new THREE.BoxGeometry(1800,.2,2),
new THREE.MeshStandardMaterial({color:0xbdbdbd})
);
p.position.set(0,.11,z);
scene.add(p);
}
footpath(12); footpath(-12);

/* CAR */
const car=new THREE.Mesh(
new THREE.BoxGeometry(3.6,1.2,1.6),
new THREE.MeshStandardMaterial({color:0x3a8cff})
);
car.position.y=.8;
scene.add(car);

/* CAMERA POSITION */
camera.position.set(-6,2,0);
camera.lookAt(car.position);

/* INPUT */
let speed=0,steer=0;
const keys={up:false,down:false,left:false,right:false};

/* KEYBOARD */
addEventListener("keydown",e=>{
if(e.code==="ArrowUp")keys.up=true;
if(e.code==="ArrowDown")keys.down=true;
if(e.code==="ArrowLeft")keys.left=true;
if(e.code==="ArrowRight")keys.right=true;
});
addEventListener("keyup",e=>{
if(e.code==="ArrowUp")keys.up=false;
if(e.code==="ArrowDown")keys.down=false;
if(e.code==="ArrowLeft")keys.left=false;
if(e.code==="ArrowRight")keys.right=false;
});

/* JOYSTICK */
const joy=document.getElementById("joystick");
const stick=document.getElementById("stick");
let active=false;

joy.addEventListener("touchstart",()=>active=true);
joy.addEventListener("touchend",()=>{
active=false;
stick.style.left="35px";
stick.style.top="35px";
keys.up=keys.down=keys.left=keys.right=false;
});

joy.addEventListener("touchmove",e=>{
if(!active)return;
const r=joy.getBoundingClientRect();
const x=e.touches[0].clientX-r.left-60;
const y=e.touches[0].clientY-r.top-60;
const dx=Math.max(-40,Math.min(40,x));
const dy=Math.max(-40,Math.min(40,y));
stick.style.left=35+dx+"px";
stick.style.top=35+dy+"px";

keys.left = dx<-15;
keys.right = dx>15;
keys.up = dy<-15;
keys.down = dy>15;
});

/* LOOP */
function animate(){
requestAnimationFrame(animate);

if(keys.up)speed+=.02;
if(keys.down)speed-=.03;
speed*=.98;

if(keys.left)steer+=.03;
if(keys.right)steer-=.03;
steer*=.85;

car.rotation.y+=steer*.02;
car.position.x+=Math.cos(car.rotation.y)*speed;
car.position.z+=Math.sin(car.rotation.y)*speed;

camera.position.lerp(
new THREE.Vector3(car.position.x-6,2,car.position.z),
.1
);
camera.lookAt(car.position);

document.getElementById("speed").textContent=
"Speed: "+Math.round(Math.abs(speed)*120)+" km/h";

renderer.render(scene,camera);
}
animate();

/* RESIZE */
addEventListener("resize",()=>{
camera.aspect=innerWidth/innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
